
<br>
<br>

<div class="countainer">
    <div class="card">
        <div class="card-body">
            <h3>Comboio</h3>
                <form class="row gx-3 gy-2 align-items-center" action="/comboiosValidate" method="POST">
                    <input type="hidden" name="id" value="{{comboios._id}}">
                        <div class="input-group mb-3">
                            <label class="input-group-text">Nome do Comboio</label>
                            <input name="comboioNome" value="{{comboios.comboioNome}}" class="form-control" type="text" disabled>
                        </div>
                        <div>
                            <h5>Embarcaçoes</h5>
                            <br>
                                <div id="selecaoComboio">
                                    <div class="container">
                                            <div class="card">
                                                <div class="card-body">
                                                        {{#each comboios.embarcacoes}}
                                                        <div id="{{id}}">
                                                        <button type="button" style="float: right" class="btn btn-danger m-1" onclick="deletecomboio('{{id}}')">Remover</button>
                                                        <input value="{{id}}" hidden>
                                                            <div class="input-group m-3">
                                                                <label class="input-group-text">Nome da Embarcação</label>
                                                                <input value="{{embarcacaoNome}}" class="form-control" type="text" disabled>
                                                            
                                                                <label class="input-group-text">Redefinir Embarcação</label>
                                                                <select name="comboio" class="btn-group">
                                                                    <option value="{{id}}">Já selecionado: {{embarcacaoNome}}</option>
                                                                    {{#each ../embarcacoes}}
                                                                        <option id="comboio" value="{{_id}}">{{embarcacaoNome}}</option>
                                                                    {{/each}}
                                                                </select>
                                                            
                                                                <label class="input-group-text">carga</label>
                                                                <input value="{{carga}}" name="comboiosCarga" class="form-control" type="text">
                                                            </div>
                                                            <div class="input-group m-3">
                                                                <label class="input-group-text">quantidade e unidade de carga</label>
                                                                <input value="{{quantidade}}" name="comboiosQuantidadeCarga" class="form-control" type="text">
                                                                <label class="input-group-text">Arqueaçao Bruta</label>
                                                                <input value="{{arqueacaoBruta}}" name="comboiosarqueacaoBruta" class="form-control" type="text">
                                                            </div>
                                                            <br>
                                                            </div>
                                                        {{/each}}                            
                                            <div id="comboios">
                                                <script>
                                                var divCounter = 0
                                                    function addInputSelect(divName) {
                                                    var newdiv = document.createElement('div');
                                                    var divId = "div" + divCounter
                                                    newdiv.setAttribute('id', divId)
                                                    newdiv.innerHTML = '<select name="comboio" class="btn-group"><option id="emBranco" value="emBranco">Em Branco</option>{{#each embarcacoes}}<option id="comboio" value="{{_id}}">{{embarcacaoNome}}</option>{{/each}}</select><button class="btn btn-danger btn-sm m-4" style="float: end" type="button" onclick="deleteBranco(\'' + divId + '\')">Excluir</button>';                            
                                                    newdiv.innerHTML += '<label class="input-group-text">carga</label>'
                                                    newdiv.innerHTML += '<input name="comboiosCarga" class="form-control" type="text">'
                                                    newdiv.innerHTML += '<label class="input-group-text">quantidade e unidade de carga</label>'
                                                    newdiv.innerHTML += '<input name="comboiosQuantidadeCarga" class="form-control" type="text">'
                                                    newdiv.innerHTML += '<label class="input-group-text">Arqueaçao Bruta</label>'
                                                    newdiv.innerHTML += '<input name="comboiosarqueacaoBruta" class="form-control" type="text">'
                                                    document.getElementById(divName).appendChild(newdiv);
                                                    document.getElementById('selecaoComboio').setAttribute('class', 'bg')
                                                    var submiteButton = document.getElementById('submitButton')
                                                    submiteButton.disabled = true
                                                    divCounter++;
                                                    document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')

                                                    }

                                                    function deleteBranco(divId){
                                                        comboiosArray = []
                                                        var emBranco = document.getElementById(divId)
                                                        emBranco.remove()
                                                        document.getElementById('selecaoComboio').setAttribute('class', 'bg')
                                                        var submiteButton = document.getElementById('submitButton')
                                                        submiteButton.disabled = true
                                                        document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                                    }

                                                    addInputSelect('lines');

                                                    function getIdcomboios(){
                                                    
                                                    var submiteButton = document.getElementById('submitButton')
                                                    submiteButton.disabled = false

                                                    var comboiosArray = []
                                                    
                                                    var comboiosCarga = []

                                                    var comboiosQuantidadeCarga = []

                                                    var comboiosarqueacaoBruta = []



                                                    var comboiosIds = document.querySelectorAll("[name='comboio']")
                                                                for (var i = 0; i < comboiosIds.length; i++) {
                                                                    if(comboiosIds[i].value == 'emBranco'){
                                                                        var submiteButton = document.getElementById('submitButton')
                                                                        submiteButton.disabled = true
                                                                        
                                                                    }
                                                            comboiosArray.push(comboiosIds[i].value)
                                                            document.getElementById('comboiosArrayIds').setAttribute('value', `${comboiosArray}`)
                                                        }

                                                        if(comboiosArray.length == 0 ){
                                                            var submiteButton = document.getElementById('submitButton')
                                                            submiteButton.disabled = true
                                                            document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                                        }
                                                        if(comboiosArray.find(el => el == 'emBranco')){
                                                            document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                                        }else{
                                                            document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-success bg-opacity-50 border-success')
                                                        }
                                                        console.log(comboiosArray)
                                                    
                                                        
                                                    }
                                                    function deletecomboio(id){
                                                        var submiteButton = document.getElementById('submitButton')
                                                        submiteButton.disabled = true
                                                        comboiosArray = []
                                                        document.getElementById(id).remove()
                                                        document.getElementById('selecaoComboio').setAttribute('class', 'bg')
                                                        document.getElementById('selecaoComboio').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                                    }
                                                                        
                                                </script>
                                            </div>
                                            <input value="" id="comboiosArrayIds" name="embarcacoes" hidden>
                                            <input value="" id="comboiosCarga" name="comboiosCargas" hidden>
                                            <input value="" id="comboiosQuantidadeCarga" name="comboiosQuantidadeCargas" hidden>
                                            <input value="" id="comboiosarqueacaoBruta" name="comboiosarqueacaoBrutas" hidden>

                                            <button class="btn btn-primary mb-4" type="button" onclick="addInputSelect('comboios')">Adicionar embarcaçao</button>
                                            
                                            <button class="btn btn-success" type="button" onclick="getIdcomboios()" style="float: right">Fechar Relação</button>
                                            </div>
                                        </div>    
                                    </div>
                                </div>
                            </div>
                        </div>
                    <button type="submit" id="submitButton" class="btn btn-success" disabled>Validar</button>
                </form>
        </div>
    </div>
</div>
{{>_saveLocalForm}}