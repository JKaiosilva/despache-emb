<br>
<h2 class="text-center mb-4">PEDIDO DE DESPACHO POR PERÍODO – NAVEGAÇÃO INTERIOR</h2>
<div class="card">
    <div class="card-body">
        <form class="row gx-3 gy-2 align-items-center" action="despacho" method="POST">
            <input type="hidden" name="usuarioID" value="%= req.user._id %">
                <div class="input-group mb-3">
                    <label class="input-group-text">N° Processo de Despacho</label>
                    <input name="NprocessoDespacho" class="form-control" type="text">
                </div>
                <br>
                <div>
                    <h4 class="text-center">Dados de Despacho (data off Clearence)</h4>
                    <div class="input-group mb-3">
                        <label class="input-group-text">Porto de Estadia</label>
                        <select id="select1" name="despachoPortoEstadia" class="form-select" onchange="outroPorto('campo1', 'select1')">
                        {{#each portos}}
                        <option value="{{_id}}">
                            {{portoNome}}
                        </option>
                        {{/each}}
                        <option id="outroPortoOption" value="Outros">Outros...</option>
                        </select>
                        <br>
                        <br>
                        <div id="campo1" hidden>
                        <label class="input-group-text">Adicione outro porto de Estadia</label>
                        <input name="despachoOutroPortoEstadia" class="form-control" type="text">
                        </div>
                        <script>
                        function outroPorto(campo, select) {
                            var outroPortoOption = document.getElementById(select);
                            var outroPortoDiv = document.getElementById(campo);

                            if (outroPortoOption.value == 'Outros') {
                            outroPortoDiv.hidden = false;
                            } else {
                            outroPortoDiv.hidden = true;
                            }
                        }
                        </script>

                        <label class="input-group-text">Data/Hora Estimada de Partida</label>
                        <input name="despachoDataHoraPartida" class="form-control" type="date">
                    </div>
                </div>
            <br>
            <h4 class="text-center">Dados de Representante da Embarcação</h4>
                <div class="input-group mb-3">
                    <label class="input-group-text">Nome</label>
                    <input name="despachoNomeRepresentanteEmbarcacao" class="form-control" type="text">
                    <label class="input-group-text">CPF/CNPJ</label>
                    <input name="despachoCPFCNPJRepresentanteEmbarcacao" class="form-control" type="text">
                </div>
                <div class="input-group mb-3">
                    <label class="input-group-text">Telephone</label>
                        <input name="despachoTelefoneRepresentanteEmbarcacao" class="form-control" type="text">
                    <label class="input-group-text">Endereço</label>
                        <input name="despachoEnderecoRepresentanteEmbarcacao" class="form-control" type="text">
                    <label class="input-group-text">E-mail</label>
                        <input name="despachoEmailRepresentanteEmbarcacao" class="form-control" type="text">
                </div>
            </div>
            <div>
                <h4 class="text-center">Informações Complementares</h4>
                    <div class="input-group mb-3">
                        <label class="input-group-text">Data da Última Inspeção Naval</label>
                        <input name="despachoDataUltimaInspecaoNaval" class="form-control" type="text">
                    </div>
                <br>
                    <label class="input-group-text">Deficiências a serem retificadas neste porto?</label>
                    <input name="despachoDeficiencias" type="text" class="form-control">
                <br>
                    <label class="input-group-text">Transporta Carga Perigosa</label>
                    <input name="despachoTransportaCargaPerigosa" type="text" class="form-control">
                <br>
                    <label class="input-group-text">Há algum certificado ou documento temporário da embarcação, cuja validade expire nos proximos 90 dias?</label>
                    <input name="despachoCertificadoTemporario90dias" type="text" class="form-control">
                <br>
                    <div class="input-group mb-3">
                        <label class="input-group-text">Caso afirmativo, informe o(s) certificado(s)/documento(s) e suas respectivas datas de validade</label>
                        <input name="despachoCasoDocumentoExpirado" class="form-control" type="text">
                    </div>
            <div>
                <h4 class="text-center">Observações</h4>
                    <div class="input-group">
                        <input name="despachoOBS" class="form-control">
                    </div>
            </div>
            <div>
                <h4 class="text-center mt-3">Lista de Tripulantes</h4>
                    <div class="input-group mb-3">
                        <label class="input-group-text">N° de Tripulantes - incluindo o Comandante</label>
                        <input name="despachoNTripulantes" class="form-control" type="text">
                        <label class="input-group-text">Nome do Comandante</label>
                        <input name="despachoNomeComandante" class="form-control" type="text">
                    </div>
            </div>
            <div id="selecaoTripulantes">
            <div class="container">
            <div>
                    <div id="tripulantes">
                        <script>
                        var divCounter = 0
                            function addInputSelect(divName) {
                            var newdiv = document.createElement('div');
                            var divId = "div" + divCounter
                            newdiv.setAttribute('id', divId)
                            newdiv.innerHTML = '<select name="tripulante" class="btn-group"><option id="emBranco" value="emBranco">Em Branco</option>{{#each tripulantes}}<option id="tripulante" value="{{_id}}">{{tripulanteNome}}</option>{{/each}}</select><button class="btn btn-danger btn-sm m-4" style="float: end" type="button" onclick="deleteBranco(\'' + divId + '\')">Excluir</button>';                            
                            document.getElementById(divName).appendChild(newdiv);
                            document.getElementById('selecaoTripulantes').setAttribute('class', 'bg')
                            var submiteButton = document.getElementById('submitButton')
                            submiteButton.disabled = true
                            divCounter++;
                            document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')

                            }

                            function deleteBranco(divId){
                                tripulantesArray = []
                                var emBranco = document.getElementById(divId)
                                emBranco.remove()
                                document.getElementById('selecaoTripulantes').setAttribute('class', 'bg')
                                var submiteButton = document.getElementById('submitButton')
                                submiteButton.disabled = true
                                document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                            }

                            addInputSelect('lines');

                            function getIdTripulantes(){
                            
                            var submiteButton = document.getElementById('submitButton')
                            submiteButton.disabled = false

                            var tripulantesArray = []

                            var tripulantesIds = document.querySelectorAll("[name='tripulante']")
                                        for (var i = 0; i < tripulantesIds.length; i++) {
                                            if(tripulantesIds[i].value == 'emBranco'){
                                                var submiteButton = document.getElementById('submitButton')
                                                submiteButton.disabled = true
                                                
                                            }
                                    tripulantesArray.push(tripulantesIds[i].value)
                                    document.getElementById('tripulantesArrayIds').setAttribute('value', `${tripulantesArray}`)
                                }
                                if(tripulantesArray.length == 0 ){
                                    var submiteButton = document.getElementById('submitButton')
                                    submiteButton.disabled = true
                                    document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                }
                                if(tripulantesArray.find(el => el == 'emBranco')){
                                    document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                                }else{
                                    document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-success bg-opacity-50 border-success')
                                }
                                console.log(tripulantesArray)
                            
                                
                            }
                            function deleteTripulante(id){
                                var submiteButton = document.getElementById('submitButton')
                                submiteButton.disabled = true
                                tripulantesArray = []
                                document.getElementById(id).remove()
                                document.getElementById('selecaoTripulantes').setAttribute('class', 'bg')
                                document.getElementById('selecaoTripulantes').setAttribute('class', 'form-control bg-danger bg-opacity-50 border-danger')
                            }
                                                
                        </script>
                    </div>
                    <input value="" id="tripulantesArrayIds" name="despachoTripulantes" hidden>
                    <button class="btn btn-primary mb-4" type="button" onclick="addInputSelect('tripulantes')">Adicionar tripulante</button>
                    
                    <button class="btn btn-success" type="button" onclick="getIdTripulantes()" style="float: right">Fechar Relação</button>
                    
                </div>
                </div>
            </div>
            </div>

                <Label>Estou ciente de que responderei administrativamente, civil e penalmente pelos eventuais dados incorretos constantes da presente declaração</Label>
                <br>
                <div class="input-group">
                <label class="input-group-text">Embarcação Principal</label>
                <select name="embarcacao" class="form-select">
                    {{#each embarcacoes}}
                        <option value="{{_id}}">{{embarcacaoNome}}</option>
                    {{else}}
                        <option value="0">Nenhuma embarcação cadastrada</option>
                    {{/each}}
                </select>
            </div>
            <br>
            <div class="input-group">
                <label class="input-group-text">Comboio</label>
                <select name="despachoComboio" class="form-select">
                    {{#each comboios}}
                        <option value="{{_id}}">{{comboioNome}}</option>
                    {{else}}
                        <option value="0">Nenhum comboio formulado</option>
                    {{/each}}
                </select>
            </div>
            <br>
            <div class="input-group mb-3">
                <label class="input-group-text">Solicitação de Vencimento do despacho</label>
                <input name="despachoDataSolicitada" class="form-control" type="date">
            </div>
            <br>
            <button type="submit" id="submitButton" class="btn btn-success" disabled>Enviar</button>
            </div>
            <br>
            
        </form>
    </div>
</div>
